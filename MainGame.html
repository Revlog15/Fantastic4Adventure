<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Adventure</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
    </style>
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <div class="game-container">
      <div class="game-log" id="game-log">
        <div class="log-entry">[00:22] Anda menemukan 10 koin!</div>
        <div class="log-entry">[00:23] Anda bergerak ke koordinat (6, 2).</div>
        <div class="log-entry">[00:25] Anda bergerak ke koordinat (5, 2).</div>
        <div class="log-entry">[00:25] Anda bergerak ke koordinat (4, 2).</div>
      </div>
      <!-- Area Utama Map -->
      <div class="map-area">
        <!-- Panel Atas: Logo dan Status -->
        <div class="top-panel">
          <div class="logo">ADVENTURE QUEST</div>
          <div class="status-area">
            <!-- Health Bar (Now Hunger) -->
            <div class="stat-group">
              <div class="stat-label">Hunger</div>
              <div class="stat-bar">
                <div class="stat-fill hunger" style="width: 50%"></div>
              </div>
              <div class="stat-value" id="hunger-value">50/100</div>
            </div>

            <!-- Energy Bar (Now Sleep) -->
            <div class="stat-group">
              <div class="stat-label">Sleep</div>
              <div class="stat-bar">
                <div class="stat-fill sleep" style="width: 0%"></div>
              </div>
              <div class="stat-value" id="sleep-value">50/100</div>
            </div>

            <!-- Mana Bar (Now Hygiene) -->
            <div class="stat-group">
              <div class="stat-label">Hygiene</div>
              <div class="stat-bar">
                <div class="stat-fill hygiene" style="width: 50%"></div>
              </div>
              <div class="stat-value" id="hygiene-value">50/100</div>
            </div>

            <!-- EXP Bar (Now Happiness) -->
            <div class="stat-group">
              <div class="stat-label">Happiness</div>
              <div class="stat-bar">
                <div class="stat-fill happiness" style="width: 50%"></div>
              </div>
              <div class="stat-value" id="happiness-value">50/100</div>
            </div>

            <!-- Info display area -->
            <div class="info-display">
              <!-- Money Display -->
              <div class="money-display">
                <span class="money-icon">üí∞</span>
                <span id="money-value">1260</span>
              </div>

              <!-- Game Time Display -->
              <div class="time-display">
                <span class="time-icon">üïí</span>
                <span id="game-time">00:39</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Map Game -->
        <div class="map">
          <div class="map-grid" id="game-map">
            <!-- Map tiles will be generated by JavaScript -->
          </div>
        </div>

        <!-- Game Log -->
      </div>

      <!-- Panel Kanan dengan Tombol-tombol Aksi -->
      <div class="action-panel">
        <button class="action-button location-specific explore">
          <span
            class="info-icon"
            data-tooltip="Cost: -10 Sleep&#10;Possible Rewards: 5-20 coins"
            >i</span
          >
          üîé Eksplorasi
        </button>
        <button class="action-button location-specific home-eat">
          <span
            class="info-icon"
            data-tooltip="Cost: 20 coins&#10;Effect: +35 Hunger"
            >i</span
          >
          üç≤ Makan
        </button>

        <button class="action-button location-specific home-bath">
          üöø Mandi
        </button>
        <button class="action-button location-specific home-sleep">
          üõå Tidur
        </button>
        <button class="action-button location-specific home-work">
          <span
            class="info-icon"
            data-tooltip="Earnings: 50-150 coins&#10;Cost: -20 Sleep, -20 Hunger -35 hygiene"
            >i</span
          >
          üíº Bekerja
        </button>
        <button class="action-button inventory">üéí Inventaris</button>

        <!-- Tombol Navigasi di panel kanan -->
        <div class="navigation-buttons">
          <button class="nav-button" data-direction="up">‚¨Ü</button>
          <button class="nav-button" data-direction="left">‚¨Ö</button>
          <button class="nav-button" data-direction="down">‚¨á</button>
          <button class="nav-button" data-direction="right">‚û°</button>
        </div>
      </div>
    </div>

    <script>
      // Inisialisasi variabel game
      const gameState = {
        playerPosition: { x: 3, y: 3 },
        playerStats: {
          hunger: 50,
          maxHunger: 100,
          sleep: 50, // Changed to match screenshot
          maxSleep: 100,
          hygiene: 50,
          maxHygiene: 100,
          happiness: 50,
          maxHappiness: 100,
          money: 500,
        },
        mapSize: { width: 8, height: 8 },
        gameTime: { hours: 0, minutes: 39 }, // Set to match screenshot
        selectedCharacter: "",
      };

      // Game time update function (1 second real time = 1 minute game time)
      function startGameTime() {
        setInterval(() => {
          // Increment minutes
          gameState.gameTime.minutes++;

          // Handle hour change
          if (gameState.gameTime.minutes >= 60) {
            gameState.gameTime.hours++;
            gameState.gameTime.minutes = 0;

            // Update stats setiap jam
            updateStats("hunger", -5); // Hunger berkurang 5 poin per jam
            updateStats("sleep", -3); // Sleep berkurang 3 poin per jam
            updateStats("hygiene", -4); // Hygiene berkurang 4 poin per jam

            // Notifikasi ke pemain jika stat terlalu rendah
            checkLowStats();
          }

          // Handle day change (24-hour cycle)
          if (gameState.gameTime.hours >= 24) {
            gameState.gameTime.hours = 0;
          }

          // Update time display
          updateTimeDisplay();

          // Simpan game state setiap 10 menit game
          if (gameState.gameTime.minutes % 10 === 0) {
            saveGameState();
          }
        }, 1000); // Update every second (1 second real time = 1 minute game time)
      }

      // Update time display
      function updateTimeDisplay() {
        const hours = String(gameState.gameTime.hours).padStart(2, "0");
        const minutes = String(gameState.gameTime.minutes).padStart(2, "0");
        document.getElementById(
          "game-time"
        ).textContent = `${hours}:${minutes}`;
      }

      // Move player function
      function movePlayer(direction) {
        let newX = gameState.playerPosition.x;
        let newY = gameState.playerPosition.y;

        switch (direction) {
          case "up":
            newY = Math.max(0, newY - 1);
            break;
          case "down":
            newY = Math.min(gameState.mapSize.height - 1, newY + 1);
            break;
          case "left":
            newX = Math.max(0, newX - 1);
            break;
          case "right":
            newX = Math.min(gameState.mapSize.width - 1, newX + 1);
            break;
        }

        // If position didn't change, do nothing
        if (
          newX === gameState.playerPosition.x &&
          newY === gameState.playerPosition.y
        ) {
          return;
        }

        // Remove character from previous tile
        const prevTile = document.querySelector(".character-tile");
        if (prevTile) {
          prevTile.classList.remove("character-tile");
          const charImg = prevTile.querySelector(".character-image");
          if (charImg) charImg.remove();
        }

        // Update player position
        gameState.playerPosition.x = newX;
        gameState.playerPosition.y = newY;

        // Add character to new tile
        const newTile = document.querySelector(
          `.map-tile[data-x="${newX}"][data-y="${newY}"]`
        );
        if (newTile) {
          newTile.classList.add("character-tile");
          const charImg = document.createElement("img");
          charImg.className = "character-image";
          charImg.src = `Character/${gameState.selectedCharacter}.png`;
          newTile.appendChild(charImg);
        }

        // Update location-specific buttons
        updateLocationButtons(newX, newY);

        // Add log entry
        addLogEntry(`Anda bergerak ke koordinat (${newX}, ${newY}).`);

        // Check for events
        checkForEvents(newX, newY);
      }

      function updateLocationButtons(x, y) {
        // Hide all location-specific buttons first
        document
          .querySelectorAll(".action-button.location-specific")
          .forEach((btn) => {
            btn.style.display = "none";
          });

        // Check if player is at a special location
        const specialLocations = [
          { name: "home", x: 1, y: 1 },
          { name: "jakarta", x: 6, y: 1 },
          { name: "padang", x: 1, y: 6 },
          { name: "magelang", x: 6, y: 6 },
          { name: "papua", x: 3, y: 3 },
        ];

        const currentLocation = specialLocations.find(
          (loc) => loc.x === x && loc.y === y
        );

        if (currentLocation) {
          if (currentLocation.name === "home") {
            // Show home-specific buttons
            document
              .querySelectorAll(
                ".action-button.home-eat, .action-button.home-bath, .action-button.home-sleep, .action-button.home-work"
              )
              .forEach((btn) => {
                btn.style.display = "block";
              });
          } else {
            // Show explore button for other locations
            document.querySelector(
              ".action-button.location-specific.explore"
            ).style.display = "block";
          }
        }
      }

      // Generate map with special locations
      function generateMap() {
        const mapElement = document.getElementById("game-map");
        mapElement.innerHTML = "";

        // Define special locations
        const specialLocations = [
          { name: "home", x: 1, y: 1 },
          { name: "jakarta", x: 6, y: 1 },
          { name: "padang", x: 1, y: 6 },
          { name: "magelang", x: 6, y: 6 },
          { name: "papua", x: 3, y: 3 },
        ];

        // Create map tiles
        for (let y = 0; y < gameState.mapSize.height; y++) {
          for (let x = 0; x < gameState.mapSize.width; x++) {
            const tile = document.createElement("div");

            // Check if this is a special location
            const specialLocation = specialLocations.find(
              (loc) => loc.x === x && loc.y === y
            );

            if (specialLocation) {
              tile.className = `map-tile special-location ${specialLocation.name}`;
              tile.dataset.location = specialLocation.name.toUpperCase();
            } else {
              tile.className = "map-tile";
            }

            // Set coordinates as data attributes
            tile.dataset.x = x;
            tile.dataset.y = y;

            // Add event listener for tile click
            tile.addEventListener("click", handleTileClick);

            mapElement.appendChild(tile);

            // If this is the player's position, add the character
            if (
              x === gameState.playerPosition.x &&
              y === gameState.playerPosition.y
            ) {
              tile.classList.add("character-tile");
              const charImg = document.createElement("img");
              charImg.className = "character-image";
              charImg.src = `Character/${gameState.selectedCharacter}.png`;
              tile.appendChild(charImg);
            }
          }
        }
      }

      // Handle tile click for movement
      function handleTileClick(event) {
        let target = event.target;

        // If clicked on character, get the parent tile
        if (target.classList.contains("character-image")) {
          target = target.parentElement;
        }

        const x = parseInt(target.dataset.x);
        const y = parseInt(target.dataset.y);

        // Calculate Manhattan distance to check if move is valid
        const dist =
          Math.abs(x - gameState.playerPosition.x) +
          Math.abs(y - gameState.playerPosition.y);

        if (dist <= 1) {
          // Only allow moving 1 tile per click
          // Remove character class from previous tile
          const prevTile = document.querySelector(".character-tile");
          if (prevTile) {
            prevTile.classList.remove("character-tile");
            const charImg = prevTile.querySelector(".character-image");
            if (charImg) charImg.remove();
          }

          // Update player position
          gameState.playerPosition.x = x;
          gameState.playerPosition.y = y;

          // Add character to new tile
          target.classList.add("character-tile");
          const charImg = document.createElement("img");
          charImg.className = "character-image";
          charImg.src = `Character/${gameState.selectedCharacter}.png`;
          target.appendChild(charImg);

          // Log action
          addLogEntry(`Anda bergerak ke koordinat (${x}, ${y}).`);

          // Check for special events
          checkForEvents(x, y);
        } else {
          addLogEntry("Terlalu jauh untuk bergerak langsung ke sana.");
        }
      }

      // Update character stats
      function updateStats(stat, change) {
    const oldValue = gameState.playerStats[stat];
    const maxStat = gameState.playerStats[`max${stat.charAt(0).toUpperCase() + stat.slice(1)}`];
    
    // Calculate new value
    let newValue = oldValue + change;
    newValue = Math.max(0, Math.min(newValue, maxStat));
    
    // Update the stat
    gameState.playerStats[stat] = newValue;
    
    // Check for warnings immediately
    if (newValue <= 50) {
        const isCritical = newValue <= 30;
        showStatWarning(stat, newValue, isCritical);
    }
    
    // Check for game over
    if (newValue <= 0) {
        checkGameOver(stat);
    }
    
    // Update display
    updateStatusDisplay();
}

function showStatWarning(stat, currentValue, isCritical) {
    const statNames = {
        hunger: {name: "Hunger", icon: "üî•", action: "makan"},
        sleep: {name: "Sleep", icon: "üí§", action: "tidur"},
        hygiene: {name: "Hygiene", icon: "üíß", action: "mandi"},
        happiness: {name: "Happiness", icon: "üíî", action: "hiburan"}
    };
    
    const message = isCritical 
        ? `${statNames[stat].icon.repeat(3)} KRITIS! ${statNames[stat].name}: ${currentValue}/100 - Segera ${statNames[stat].action}!`
        : `${statNames[stat].icon} Warning! ${statNames[stat].name}: ${currentValue}/100 - Anda butuh ${statNames[stat].action}`;
    
    addLogEntry(message);
    
    // Start pulsing animation for critical
    if (isCritical) {
        const statBar = document.querySelector(`.stat-fill.${stat}`);
        statBar.style.animation = `pulse-${stat} 0.8s infinite`;
    }
}
      // Add this new function to check for game over
      function checkGameOver(stat) {
    if (gameState.playerStats[stat] <= 0) {
        const statNames = {
            hunger: "Kelaparan",
            sleep: "Kelelahan",
            hygiene: "Kebersihan",
            happiness: "Kebahagiaan"
        };
        
        clearInterval(gameTimeInterval);
        addLogEntry(`GAME OVER! ${statNames[stat]} Anda mencapai 0.`);
        showGameOverModal(statNames[stat]);
    }
}

function showGameOverModal(reason) {
    // Remove existing modal if any
    const existingModal = document.querySelector('.game-over-modal');
    if (existingModal) existingModal.remove();
    
    const modal = document.createElement('div');
    modal.className = 'game-over-modal';
    modal.innerHTML = `
        <div class="game-over-content">
            <h2>GAME OVER</h2>
            <p>${reason} Anda mencapai 0!</p>
            <p>Permainan akan direset dalam 5 detik...</p>
            <button id="restart-button">Mulai Ulang Sekarang</button>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Make sure modal is visible
    modal.style.display = 'flex';
    modal.style.zIndex = '10000';
    
    // Button click handler
    document.getElementById('restart-button').addEventListener('click', resetGame);
    
    // Auto-reset after 5 seconds
    setTimeout(resetGame, 5000);
}

function resetGame() {
    localStorage.removeItem('gameState');
    window.location.reload();
}

      // Don't forget to declare the gameTimeInterval at the top
      let gameTimeInterval; // Declare at the top with other variables

function startGameTime() {
    // Clear any existing interval to prevent duplicates
    if (gameTimeInterval) {
        clearInterval(gameTimeInterval);
    }
    
    gameTimeInterval = setInterval(() => {
        gameState.gameTime.minutes++;
        
        if (gameState.gameTime.minutes >= 60) {
            gameState.gameTime.hours++;
            gameState.gameTime.minutes = 0;
            
            // Hourly stat decreases
            updateStats('hunger', -5);
            updateStats('sleep', -3);
            updateStats('hygiene', -4);
            
            // Check for low stats every hour
            checkLowStats();
        }
        
        if (gameState.gameTime.hours >= 24) {
            gameState.gameTime.hours = 0;
        }
        
        updateTimeDisplay();
        
        // Auto-save every 10 minutes
        if (gameState.gameTime.minutes % 10 === 0) {
            saveGameState();
        }
    }, 1000); // 1 second real time = 1 minute game time
}
      // Update status display
      function updateStatusDisplay() {
    // Update all stat values
    document.getElementById('hunger-value').textContent = `${gameState.playerStats.hunger}/${gameState.playerStats.maxHunger}`;
    document.getElementById('sleep-value').textContent = `${gameState.playerStats.sleep}/${gameState.playerStats.maxSleep}`;
    document.getElementById('hygiene-value').textContent = `${gameState.playerStats.hygiene}/${gameState.playerStats.maxHygiene}`;
    document.getElementById('happiness-value').textContent = `${gameState.playerStats.happiness}/${gameState.playerStats.maxHappiness}`;
    
    // Update stat bars
    updateStatBar('hunger');
    updateStatBar('sleep');
    updateStatBar('hygiene');
    updateStatBar('happiness');
    
    // Update money display
    document.getElementById('money-value').textContent = gameState.playerStats.money;
}

function updateStatBar(stat) {
    const bar = document.querySelector(`.stat-fill.${stat}`);
    const max = gameState.playerStats[`max${stat.charAt(0).toUpperCase() + stat.slice(1)}`];
    const percentage = (gameState.playerStats[stat] / max) * 100;
    
    // Update width and color
    bar.style.width = `${percentage}%`;
    
    // Handle animation
    if (gameState.playerStats[stat] <= 30) {
        bar.style.animation = `pulse-${stat} 0.8s infinite`;
    } else {
        bar.style.animation = 'none';
        // Reset to original colors
        bar.style.opacity = '1';
        bar.style.boxShadow = 
            stat === 'hunger' ? '0 0 5px #ff1744' :
            stat === 'sleep' ? '0 0 5px #ffa000' :
            stat === 'hygiene' ? '0 0 5px #00b0ff' :
            '0 0 5px #00e676';
    }
}

      // Add log entry
      function addLogEntry(message) {
        const logElement = document.getElementById("game-log");
        const entry = document.createElement("div");
        entry.className = "log-entry";

        // Add timestamp to log entries
        const hours = String(gameState.gameTime.hours).padStart(2, "0");
        const minutes = String(gameState.gameTime.minutes).padStart(2, "0");
        entry.textContent = `[${hours}:${minutes}] ${message}`;

        logElement.appendChild(entry);

        // Auto-scroll to latest entry
        logElement.scrollTop = logElement.scrollHeight;

        // Limit number of entries (optional)
        if (logElement.children.length > 20) {
          logElement.removeChild(logElement.children[0]);
        }
      }

      // Check for special events on tiles
      // Tambahkan fungsi berikut ke MainGame.html untuk navigasi ke lokasi

      // Fungsi untuk mengecek special events dan menambahkan navigasi ke lokasi tertentu
      function checkForEvents(x, y) {
        // Special locations for 8x8 grid
        const specialLocations = [
          { name: "HOME", x: 1, y: 1, file: "Home.html" },
          { name: "JAKARTA", x: 6, y: 1, file: "Jakarta.html" },
          { name: "PADANG", x: 1, y: 6, file: "Padang.html" },
          { name: "MAGELANG", x: 6, y: 6, file: "Magelang.html" },
          { name: "PAPUA", x: 3, y: 3, file: "Papua.html" },
        ];

        const locationMessages = {
          HOME: "üè† Home sweet home! Gunakan tombol aksi untuk makan, mandi, atau tidur.",
          JAKARTA:
            "üèôÔ∏è Selamat datang di Jakarta! Jelajahi Monas dan keramaian kota.",
          PADANG: "üåã Masuki tanah Minang! Jangan lupa cicipi rendangnya.",
          MAGELANG:
            "üõï Anda dekat dengan Candi Borobudur. Ambil foto yang epik!",
          PAPUA: "üå¥ Datanglah ke Honai! Nikmati alam Papua yang mempesona.",
        };

        const specialLocation = specialLocations.find(
          (loc) => loc.x === x && loc.y === y
        );
        if (specialLocation) {
          // Gunakan pesan custom jika ada, jika tidak pakai pesan default
          const customMessage =
            locationMessages[specialLocation.name] ||
            `Anda tiba di ${specialLocation.name}.`;
          addLogEntry(customMessage);

          // Time-specific events
          const hour = gameState.gameTime.hours;
          if (hour >= 22 || hour < 6) {
            addLogEntry("Sudah malam hari. Waktunya beristirahat.");
          }
        } else if (Math.random() < 0.2) {
          // Random event logic (unchanged)
          const event = Math.random();
          if (event < 0.4) {
            const coins = Math.floor(Math.random() * 20) + 5;
            gameState.playerStats.money += coins;
            addLogEntry(`Anda menemukan ${coins} koin!`);
            updateStatusDisplay();
          } else if (event < 0.7) {
            addLogEntry("Anda menemukan sebuah item.");
          } else if (event < 0.9) {
            addLogEntry("Anda diserang musuh! Bersiaplah untuk pertempuran!");
          } else {
            const healAmount = Math.floor(Math.random() * 20) + 5;
            updateStats("hunger", healAmount);
            addLogEntry(
              `Anda menemukan mata air penyembuhan. Hunger +${healAmount}!`
            );
          }
        }
      }

      // Fungsi untuk menyimpan status game
      function saveGameState() {
        const gameStateData = {
          playerPosition: gameState.playerPosition,
          playerStats: gameState.playerStats,
          mapSize: gameState.mapSize,
          gameTime: gameState.gameTime,
          selectedCharacter: gameState.selectedCharacter,
          inventory: gameState.inventory || [],
          collectedItems: gameState.collectedItems || {},
        };

        localStorage.setItem("gameState", JSON.stringify(gameStateData));
      }

      // Fungsi untuk memuat status game
      function loadGameState() {
        const savedState = localStorage.getItem("gameState");
        if (savedState) {
          const parsedState = JSON.parse(savedState);

          // Update gameState dengan data yang disimpan
          if (parsedState.playerStats)
            gameState.playerStats = parsedState.playerStats;
          if (parsedState.gameTime) gameState.gameTime = parsedState.gameTime;
          if (parsedState.inventory)
            gameState.inventory = parsedState.inventory;
          if (parsedState.collectedItems)
            gameState.collectedItems = parsedState.collectedItems;

          // Jika kembali dari lokasi, gunakan posisi yang tersimpan
          // Jika pertama kali main, gunakan posisi default
          if (parsedState.playerPosition) {
            gameState.playerPosition = parsedState.playerPosition;
          }
        }

        // Set karakter dari localStorage
        const selectedChar = localStorage.getItem("selectedCharacter");
        if (selectedChar) {
          gameState.selectedCharacter = selectedChar;

          // Format untuk file image
          gameState.selectedCharacter =
            gameState.selectedCharacter.charAt(0).toUpperCase() +
            gameState.selectedCharacter.slice(1).toLowerCase();
        }
      }

      // Tambahkan ini ke initGame
      function initGame() {
        // Load game state terlebih dahulu
        loadGameState();

        // Generate map
        generateMap();
        updateStatusDisplay();
        updateTimeDisplay();
        startGameTime();

        // Add initial log entry
        addLogEntry(
          `Game dimulai dengan karakter ${gameState.selectedCharacter}.`
        );

        // Jika ada inventaris, buat panel
        createInventoryPanel();
      }

      // Tambahkan fungsi ini untuk menampilkan inventaris
      function createInventoryPanel() {
        // Check if panel doesn't exist yet
        if (!document.getElementById("inventory-panel")) {
          const inventoryPanel = document.createElement("div");
          inventoryPanel.id = "inventory-panel";
          inventoryPanel.className = "inventory-panel";

          inventoryPanel.innerHTML = `
            <h2>Inventaris</h2>
            <div id="inventory-grid" class="inventory-grid"></div>
            <button class="close-inventory" onclick="toggleInventory(false)">Tutup</button>
        `;

          document.body.appendChild(inventoryPanel);
        }
      }

      // Fungsi untuk toggle inventaris
      function toggleInventory(show) {
        const panel = document.getElementById("inventory-panel");
        if (!panel && show) {
          createInventoryPanel();
          updateInventoryDisplay();
          document.getElementById("inventory-panel").style.display = "block";
        } else if (panel) {
          panel.style.display = show ? "block" : "none";
          if (show) {
            updateInventoryDisplay();
          }
        }
      }

      // Fungsi untuk update inventaris
      function updateInventoryDisplay() {
        const grid = document.getElementById("inventory-grid");
        if (!grid) return;

        grid.innerHTML = "";

        if (!gameState.inventory || gameState.inventory.length === 0) {
          grid.innerHTML =
            '<p style="grid-column: span 4; text-align: center; color: #aaa;">Inventaris kosong. Jelajahi lokasi untuk menemukan barang!</p>';
          return;
        }

        gameState.inventory.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.className = "inventory-item";
          itemElement.innerHTML = `
            <div class="inventory-item-icon">${item.icon}</div>
            <div class="inventory-item-name">${item.name}</div>
            <div class="inventory-item-value">${item.value} koin</div>
        `;

          // Tambahkan tooltip atau detail saat di-klik
          itemElement.addEventListener("click", () => {
            alert(
              `${item.name}\nNilai: ${item.value} koin\nDitemukan di: ${
                item.location || "Unknown"
              }`
            );
          });

          grid.appendChild(itemElement);
        });
      }

      // Update event listener untuk tombol inventory
      document.addEventListener("DOMContentLoaded", () => {
        // Event listeners untuk tombol inventaris
        const inventoryButton = document.querySelector(
          ".action-button.inventory"
        );
        if (inventoryButton) {
          inventoryButton.addEventListener("click", () => {
            toggleInventory(true);
          });
        }

        // Event listener untuk tombol escape
        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") {
            toggleInventory(false);
          } else if (event.key === "i" || event.key === "I") {
            toggleInventory(true);
          }
        });
      });
      // Tambahkan ini ke bagian <script> MainGame.html untuk memperbaiki pergerakan dan mengubah cara masuk ke kota

      // Perbaikan untuk keyboard event listener
      document.addEventListener("keydown", function (event) {
        switch (event.key) {
          case "ArrowUp":
            movePlayer("up");
            break;
          case "ArrowDown":
            movePlayer("down");
            break;
          case "ArrowLeft":
            movePlayer("left");
            break;
          case "ArrowRight":
            movePlayer("right");
            break;
          case "i":
          case "I":
            toggleInventory(true);
            break;
          case "Escape":
            toggleInventory(false);
            break;
        }
      });

      // Tambahkan event listener untuk tombol navigasi saat DOM loaded
      document.addEventListener("DOMContentLoaded", function () {
        // Set up arrow buttons
        document.querySelectorAll(".nav-button").forEach((button) => {
          button.addEventListener("click", function () {
            const direction = this.getAttribute("data-direction");
            movePlayer(direction);
          });
        });

        // Set up explore button to handle city exploration
        document
          .querySelector(".action-button.explore")
          .addEventListener("click", function () {
            exploreOrEnterCity();
          });

        // Set up inventory button
        document
          .querySelector(".action-button.inventory")
          .addEventListener("click", function () {
            toggleInventory(true);
          });

        // Set up other action buttons
        setupActionButtons();
      });

      // Fungsi untuk setup action buttons lainnya
      function setupActionButtons() {
        // Home actions
        const eatButton = document.querySelector(".action-button.home-eat");
        if (eatButton) {
          eatButton.addEventListener("click", function () {
            if (gameState.playerStats.money >= 20) {
              gameState.playerStats.money -= 20;
              updateStats("hunger", 35);
              addLogEntry(
                "Anda makan makanan lezat. Hunger +35 (Biaya: 20 koin)"
              );
            } else {
              addLogEntry(
                "Uang tidak cukup untuk membeli makanan! (Biaya Makanan: 20 koin)"
              );
            }
          });
        }

        const bathButton = document.querySelector(".action-button.home-bath");
        if (bathButton) {
          bathButton.addEventListener("click", function () {
            updateStats("hygiene", 100);
            addLogEntry("Anda mandi dan merasa segar.");
          });
        }

        const sleepButton = document.querySelector(".action-button.home-sleep");
        if (sleepButton) {
          sleepButton.addEventListener("click", function () {
            updateStats("sleep", 100);
            addLogEntry("Anda tidur nyenyak.");
          });
        }

        const workButton = document.querySelector(".action-button.home-work");
        if (workButton) {
          workButton.addEventListener("click", function () {
            if (
              gameState.playerStats.sleep >= 20 &&
              gameState.playerStats.hunger >= 20
            ) {
              const earnings = Math.floor(Math.random() * 100) + 50;
              gameState.playerStats.money += earnings;
              updateStats("sleep", -20);
              updateStats("hunger", -20);
              updateStats("hygiene", -35);
              addLogEntry(
                `Anda bekerja dan mendapatkan ${earnings} koin! (Sleep -20, Hunger -20, Hygiene -35)`
              );
            } else {
              addLogEntry("Anda terlalu lelah atau lapar untuk bekerja!");
            }
          });
        }

        // Explore button for other locations
        const exploreButton = document.querySelector(
          ".action-button.location-specific.explore"
        );
        if (exploreButton) {
          exploreButton.addEventListener("click", exploreOrEnterCity);
        }

        // Previous attack and heal buttons remain the same
        const attackButton = document.querySelector(".action-button.attack");
        if (attackButton) {
          attackButton.addEventListener("click", function () {
            addLogEntry("Tidak ada musuh untuk diserang.");
          });
        }

        const healButton = document.querySelector(".action-button.heal");
        if (healButton) {
          healButton.addEventListener("click", function () {
            if (gameState.playerStats.hygiene >= 15) {
              updateStats("hygiene", -15);
              updateStats("hunger", 20);
              addLogEntry("Anda menggunakan sihir penyembuhan. Hunger +20!");
            } else {
              addLogEntry("Hygiene tidak cukup untuk penyembuhan!");
            }
          });
        }
      }

      // Fungsi untuk eksplorasi atau masuk ke kota
      function exploreOrEnterCity() {
        // Cek apakah cukup energy untuk eksplorasi
        if (gameState.playerStats.sleep < 10) {
          addLogEntry("Sleep tidak cukup untuk eksplorasi!");
          return;
        }

        // Kurangi energy
        updateStats("sleep", -10);

        // Cek apakah player berada di special location
        const specialLocations = [
          { name: "HOME", x: 1, y: 1, file: "Home.html" },
          { name: "JAKARTA", x: 6, y: 1, file: "Jakarta.html" },
          { name: "PADANG", x: 1, y: 6, file: "Padang.html" },
          { name: "MAGELANG", x: 6, y: 6, file: "Magelang.html" },
          { name: "PAPUA", x: 3, y: 3, file: "Papua.html" },
        ];

        const playerX = gameState.playerPosition.x;
        const playerY = gameState.playerPosition.y;
        const specialLocation = specialLocations.find(
          (loc) => loc.x === playerX && loc.y === playerY
        );

        if (specialLocation) {
          // Player berada di special location, masuk ke kota
          addLogEntry(`Anda menjelajahi ${specialLocation.name}...`);

          setTimeout(() => {
            addLogEntry(
              `Anda menemukan pintu masuk menuju ${specialLocation.name}!`
            );

            // Simpan game state
            saveGameState();

            // Arahkan ke halaman kota
            window.location.href = specialLocation.file;
          }, 1000);
        } else {
          // Normal exploration dalam overworld
          addLogEntry("Anda menjelajahi area sekitar...");

          setTimeout(() => {
            // Random exploration results
            const result = Math.random();
            if (result < 0.3) {
              // Find coins
              const coins = Math.floor(Math.random() * 15) + 5;
              gameState.playerStats.money += coins;
              addLogEntry(`Anda menemukan ${coins} koin!`);
              updateStatusDisplay();
            } else if (result < 0.6) {
              // Find nothing
              addLogEntry("Tidak ada yang menarik di sekitar sini.");
            } else if (result < 0.8) {
              // Hint about locations
              const nearestLocation = findNearestLocation(playerX, playerY);
              if (nearestLocation) {
                const distance =
                  Math.abs(playerX - nearestLocation.x) +
                  Math.abs(playerY - nearestLocation.y);

                if (distance <= 2) {
                  addLogEntry(
                    `Anda sangat dekat dengan ${nearestLocation.name}!`
                  );
                } else if (distance <= 4) {
                  addLogEntry(
                    `${nearestLocation.name} tidak terlalu jauh dari sini.`
                  );
                } else {
                  addLogEntry(
                    `Anda melihat petunjuk arah ke ${nearestLocation.name} di kejauhan.`
                  );
                }
              }
            } else {
              // Happiness boost
              updateStats("happiness", 5);
              addLogEntry(
                "Pemandangan indah di sekitar membuat Anda merasa bahagia!"
              );
            }
          }, 1000);
        }
      }

      // Fungsi untuk menemukan lokasi terdekat dari posisi player
      function findNearestLocation(playerX, playerY) {
        const specialLocations = [
          { name: "HOME", x: 1, y: 1 },
          { name: "JAKARTA", x: 6, y: 1 },
          { name: "PADANG", x: 1, y: 6 },
          { name: "MAGELANG", x: 6, y: 6 },
          { name: "PAPUA", x: 3, y: 3 },
        ];

        // Filter out current location
        const otherLocations = specialLocations.filter(
          (loc) => loc.x !== playerX || loc.y !== playerY
        );

        if (otherLocations.length === 0) return null;

        // Find nearest
        return otherLocations.reduce((nearest, current) => {
          const distCurrent =
            Math.abs(playerX - current.x) + Math.abs(playerY - current.y);
          const distNearest =
            Math.abs(playerX - nearest.x) + Math.abs(playerY - nearest.y);

          return distCurrent < distNearest ? current : nearest;
        });
      }

      // Fungsi untuk menyimpan game state
      function saveGameState() {
        const gameStateData = {
          playerPosition: gameState.playerPosition,
          playerStats: gameState.playerStats,
          mapSize: gameState.mapSize,
          gameTime: gameState.gameTime,
          selectedCharacter: gameState.selectedCharacter,
          inventory: gameState.inventory || [],
          collectedItems: gameState.collectedItems || {},
        };

        localStorage.setItem("gameState", JSON.stringify(gameStateData));
      }

      // Fungsi untuk memuat game state
      function loadGameState() {
        const savedState = localStorage.getItem("gameState");
        if (savedState) {
          const parsedState = JSON.parse(savedState);

          // Update gameState dengan data yang disimpan
          if (parsedState.playerStats)
            gameState.playerStats = parsedState.playerStats;
          if (parsedState.gameTime) gameState.gameTime = parsedState.gameTime;
          if (parsedState.inventory)
            gameState.inventory = parsedState.inventory;
          if (parsedState.collectedItems)
            gameState.collectedItems = parsedState.collectedItems;

          // Jika kembali dari lokasi, gunakan posisi yang tersimpan
          // Jika pertama kali main, gunakan posisi default
          if (parsedState.playerPosition) {
            gameState.playerPosition = parsedState.playerPosition;
          }
        }

        // Set karakter dari localStorage
        const selectedChar = localStorage.getItem("selectedCharacter");
        if (selectedChar) {
          gameState.selectedCharacter = selectedChar;

          // Format untuk file image
          gameState.selectedCharacter =
            gameState.selectedCharacter.charAt(0).toUpperCase() +
            gameState.selectedCharacter.slice(1).toLowerCase();
        }
      }

      // Update fungsi initGame untuk memuat game state
      function initGame() {
        // Load game state terlebih dahulu
        loadGameState();

        // Generate map
        generateMap();
        updateStatusDisplay();
        updateTimeDisplay();
        startGameTime();

        // Add initial log entry
        addLogEntry(
          `Game dimulai dengan karakter ${gameState.selectedCharacter}.`
        );

        // Create inventory panel
        createInventoryPanel();

        // Update location buttons based on initial position
        updateLocationButtons(
          gameState.playerPosition.x,
          gameState.playerPosition.y
        );
      }

      // Panel inventaris dan fungsinya
      function createInventoryPanel() {
        // Check if panel doesn't exist yet
        if (!document.getElementById("inventory-panel")) {
          const inventoryPanel = document.createElement("div");
          inventoryPanel.id = "inventory-panel";
          inventoryPanel.className = "inventory-panel";

          inventoryPanel.innerHTML = `
            <h2>Inventaris</h2>
            <div id="inventory-grid" class="inventory-grid"></div>
            <button class="close-inventory" onclick="toggleInventory(false)">Tutup</button>
        `;

          document.body.appendChild(inventoryPanel);
        }
      }

      function toggleInventory(show) {
        const panel = document.getElementById("inventory-panel");
        if (!panel && show) {
          createInventoryPanel();
          updateInventoryDisplay();
          document.getElementById("inventory-panel").style.display = "block";
        } else if (panel) {
          panel.style.display = show ? "block" : "none";
          if (show) {
            updateInventoryDisplay();
          }
        }
      }

      function updateInventoryDisplay() {
        const grid = document.getElementById("inventory-grid");
        if (!grid) return;

        grid.innerHTML = "";

        if (!gameState.inventory || gameState.inventory.length === 0) {
          grid.innerHTML =
            '<p style="grid-column: span 4; text-align: center; color: #aaa;">Inventaris kosong. Jelajahi lokasi untuk menemukan barang!</p>';
          return;
        }

        gameState.inventory.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.className = "inventory-item";
          itemElement.innerHTML = `
            <div class="inventory-item-icon">${item.icon}</div>
            <div class="inventory-item-name">${item.name}</div>
            <div class="inventory-item-value">${item.value} koin</div>
        `;

          // Tambahkan tooltip atau detail saat di-klik
          itemElement.addEventListener("click", () => {
            alert(
              `${item.name}\nNilai: ${item.value} koin\nDitemukan di: ${
                item.location || "Unknown"
              }`
            );
          });

          grid.appendChild(itemElement);
        });
      }
      // Fungsi untuk mengecek stat rendah
      function checkLowStats() {
    // Hunger warnings
    if (gameState.playerStats.hunger <= 50) {
        const urgency = gameState.playerStats.hunger <= 30 ? 'üî•üî•üî• KRITIS!' : 'üî• Warning!';
        addLogEntry(`${urgency} Hunger: ${gameState.playerStats.hunger}/100 - ${gameState.playerStats.hunger <= 30 ? 'Cari makanan segera!' : 'Anda merasa lapar'}`);
        
        // Visual feedback for critical
        if (gameState.playerStats.hunger <= 30) {
            document.querySelector('.stat-fill.hunger').style.animation = 'pulse-red 0.8s infinite';
        }
    }
    
    // Sleep warnings
    if (gameState.playerStats.sleep <= 50) {
        const urgency = gameState.playerStats.sleep <= 30 ? 'üí§üí§üí§ KRITIS!' : 'üí§ Warning!';
        addLogEntry(`${urgency} Sleep: ${gameState.playerStats.sleep}/100 - ${gameState.playerStats.sleep <= 30 ? 'Istirahat sekarang!' : 'Anda mengantuk'}`);
        
        if (gameState.playerStats.sleep <= 30) {
            document.querySelector('.stat-fill.sleep').style.animation = 'pulse-yellow 0.8s infinite';
        }
    }
    
    // Hygiene warnings
    if (gameState.playerStats.hygiene <= 50) {
        const urgency = gameState.playerStats.hygiene <= 30 ? 'üíßüíßüíß KRITIS!' : 'üíß Warning!';
        addLogEntry(`${urgency} Hygiene: ${gameState.playerStats.hygiene}/100 - ${gameState.playerStats.hygiene <= 30 ? 'Bersihkan diri segera!' : 'Anda merasa kotor'}`);
        
        if (gameState.playerStats.hygiene <= 30) {
            document.querySelector('.stat-fill.hygiene').style.animation = 'pulse-blue 0.8s infinite';
        }
    }
    
    // Happiness warnings
    if (gameState.playerStats.happiness <= 50) {
        const urgency = gameState.playerStats.happiness <= 30 ? 'üíîüíîüíî KRITIS!' : 'üíî Warning!';
        addLogEntry(`${urgency} Happiness: ${gameState.playerStats.happiness}/100 - ${gameState.playerStats.happiness <= 30 ? 'Lakukan sesuatu yang menyenangkan!' : 'Anda merasa tidak bahagia'}`);
        
        if (gameState.playerStats.happiness <= 30) {
            document.querySelector('.stat-fill.happiness').style.animation = 'pulse-green 0.8s infinite';
        }
    }
}
      // Start the game when the page loads
      window.onload = initGame;
    </script>
    <div id="inventory-panel" class="inventory-panel">
      <h2>Inventaris</h2>
      <div id="inventory-grid" class="inventory-grid"></div>
      <button class="close-inventory" onclick="toggleInventory(false)">
        Tutup
      </button>
    </div>
  </body>
</html>
